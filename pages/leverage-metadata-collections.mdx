import { Steps } from "nextra/components";
import { Callout } from "nextra/components";
import { Box, Text, Section } from "@radix-ui/themes";

# Leverage Metadata Collections

<Section size="1">
  <Text size="4">
    Canopy generates new IIIF Collections based on the [metadata](/configuration#metadata) labels included in your `config/canopy.json` file.
    For each unique string value associated with the label across IIIF Manifests found in your project, a new
    IIIF Collection is created. These Collections are used to create facets across your site and are also available
    for reuse in custom content.
  </Text>
</Section>

<Callout>
  This guide assumes you have a Canopy IIIF project. See the [Create a
  Project](/get-started) guide to get started.
</Callout>

## Use Case

You are a researcher creating a digital scholarship project and would like to add a custom content page
with a Slider component that displays all the works in your collection that have a "Subject" of "War pensions".

```json {5,10}
  "metadata": [
    {
      "label": {
        "en": [
          "Subject"
        ]
      },
      "value": {
        "en": [
          "War pensions",
          "Tennessee--Politics and government--To 1865"
        ]
      }
    }
  ]
```

## Implementation

<Steps>
### Add Metadata Labels to the **metadata** Property of your Config

In order for Canopy to generate a Collection for a given metadata label, you must add the label to the
`metadata` property in your `config/canopy.json` file. The `metadata` property is an array of metadata labels that
match string values in your Manifest URI metadata entries.

Since you need a Collection for the "Subject" label with value of "War pensions", you need to add the label to your
`metadata` array if it's not already there.

```json filename="config/canopy.json" {12,24}
  {
    "prod": {
      "label": { "none": ["Tennessee Documentary History"] },
      "collection": "https://digital.lib.utk.edu/assemble/collection/collections/tdh",
      "featured": [],
      "metadata": ["Subject", "Place", "Format", "Date"]
    },
    "dev": {
      "label": { "none": ["Tennessee Documentary History"] },
      "collection": "https://digital.lib.utk.edu/assemble/collection/collections/tdh",
      "featured": [],
      "metadata": ["Subject", "Place", "Format", "Date"]
     }
  }
```

### Validate that the Collection was Generated

<Callout type="info">
  If you have defined `NEXT_PUBLIC_BASE_PATH` in your `.env` file, you will need to include that pattern in your URI.
</Callout>

IIIF Collections are generated when your site is rebuilt or when your server is restarted. After you've added the
metadata label to your `config/canopy.json` file, you should make sure your collection exists.  If you are working
directly in GitHub with GitHub Pages, you can commit the change and wait for the site to rebuild. If you are working
locally, you will need to stop your local server:`ctrl + c` and then `npm run dev` to restart your local server.

Once your site is running, you can check that the IIIF Collection was generated by visiting the Collection URI in your
browser. Canopy uses the [slugify](https://www.npmjs.com/package/slugify) package when generating IIIF Collections. In
this process, both the metadata label and metadata value are *slugified* to create the route to you collection. Slugifying
is beneficial for search engine optimization and readability.

The pattern for the URI for your Collection will be your site's base path followed by `/api/facet/${facet.slug}/${value.slug}`.
In this example, the Collection URI would be `/api/facet/subject/war-pensions`.

<Box m="9" my="6">
  ![Example Generated Collection](/examples/war-pensions-collection.png)
</Box>


### Add the Collection to your Custom Content

Now that you have confirmed the generated Collection is available, you can add it to your custom content. Let's say
you want to use the Collection in a Slider component on a custom content page called `history` in the `about` section
of your site. You would create or modify the file according to the [Create Markdown Content Guide](/docs/create-markdown-content)
and add the Slider component where you want it to appear on the page with your Collection URI as the value of the
`iiifContent` attribute.

```mdx filename="content/about/history.mdx" {19}
---
title: History
navigation: "about"
---

# War Pensions

During the American Civil War, the issue of war pensions emerged as a crucial aspect of post-conflict reconstruction. As
the nation grappled with the devastating aftermath of the war, the U.S. government recognized the need to support the
veterans who had sacrificed their well-being for the Union or the Confederacy. War pensions, providing financial
assistance and support to disabled veterans, widows, and orphans, became a cornerstone of the post-war social contract.
The Pension Acts of 1862 and 1864 marked significant legislative milestones, establishing the framework for compensating
soldiers and their families for injuries, disabilities, and loss of life incurred during the conflict. These early
pension initiatives laid the foundation for the more comprehensive pension system that would evolve in subsequent
decades, reflecting the government's commitment to honoring and caring for those who bore the burdens of the Civil War.

## Explore Works Related to War Pensions

<Slider iiifContent="/api/facet/subject/war-pensions.json" />

```

<Callout type="info">
  Read more about creating custom content in the [Create Markdown Content Guide](/docs/create-markdown-content).
</Callout>

### Modifying the Order of the Generated Collection

You may want to modify the order of the generated Collection for display. By default, generated collections are ordered
according to the order of the manifests in your overarching IIIF Collection.

In Canopy, you can modify the order of the generated Collection by adding a `sort` parameter to your Collection URI with
the value of how you want the Collection sorted. In this example, we want to sort the Collection randomly so that users
see a different order of works each time they visit the page. To do this, we would add the `sort` parameter to the end
of the URI and set it equal to `random`.

```mdx filename="content/about/history.mdx" {19}
---
title: History
navigation: "about"
---

# War Pensions

During the American Civil War, the issue of war pensions emerged as a crucial aspect of post-conflict reconstruction. As
the nation grappled with the devastating aftermath of the war, the U.S. government recognized the need to support the
veterans who had sacrificed their well-being for the Union or the Confederacy. War pensions, providing financial
assistance and support to disabled veterans, widows, and orphans, became a cornerstone of the post-war social contract.
The Pension Acts of 1862 and 1864 marked significant legislative milestones, establishing the framework for compensating
soldiers and their families for injuries, disabilities, and loss of life incurred during the conflict. These early
pension initiatives laid the foundation for the more comprehensive pension system that would evolve in subsequent
decades, reflecting the government's commitment to honoring and caring for those who bore the burdens of the Civil War.

## Explore Works Related to War Pensions

<Slider iiifContent="/api/facet/subject/war-pensions?sort=random" />

```

<Callout type="info">
  In addition to `random`, you can also `lexical` which will sort the Collection alphabetically and `reverse` which will
  sort the collection in reverse alphabetical order.
</Callout>

<Box m="9" my="6">
  ![Example War Pensions Content](/examples/war-pensions-example.png)
</Box>

</Steps>