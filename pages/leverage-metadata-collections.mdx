import { Steps } from "nextra/components";
import { Callout } from "nextra/components";
import { Box, Text, Section } from "@radix-ui/themes";

# Leverage Metadata Collections

<Section size="1">
  <Text size="4">
    Canopy generates new IIIF Collections based on the metadata labels included in your `config/canopy.json` file.
    For each unique string value associated with the label across the IIIF manifests found in your project, a new
    IIIF Collection is created. These Collections are used to create facets across your site and are also available
    for reuse in custom content.
  </Text>
</Section>

<Callout>
  This guide assumes you have a Canopy IIIF project. See the [Create a
  Project](/get-started) guide to get started.
</Callout>

## Use Case

You are a researcher creating a digital scholarship site and would like to create a custom content page
with a Slider component that displays all the works in your collection that have a "Subject" of "War pensions".

## Implementation

<Steps>
### Add Metadata Labels to the **metadata** Property of your Config

In order for Canopy to generate a Collection for a given metadata label, you must add the label to the
`metadata` property in your `config/canopy.json` file. The `metadata` property is an array of metadata labels that
match string values in your Manifest URI metadata entries.

Since you need a Collection for the "Subject" label with value of "War pensions", you need to add the label to your
`metadata` array if it's not already there.

```json filename="config/canopy.json" {12,24}
  {
    "prod": {
      "label": { "none": ["Tennessee Documentary History"] },
      "collection": "https://digital.lib.utk.edu/assemble/collection/collections/tdh",
      "featured": [],
      "metadata": ["Subject", "Place", "Format", "Date"]
    },
    "dev": {
      "label": { "none": ["Tennessee Documentary History"] },
      "collection": "https://digital.lib.utk.edu/assemble/collection/collections/tdh",
      "featured": [],
      "metadata": ["Subject", "Place", "Format", "Date"]
     }
  }
```

### Check that the Collection was Generated

<Callout type="info">
  If you have defined `NEXT_PUBLIC_BASE_PATH` in your `.env` file, you will need to include that pattern in your URI.
</Callout>

IIIF Collections are generated when your site is rebuilt or when your server is restarted. After you've added the
metadata label to your `config/canopy.json` file, you should make sure your collection exists.  If you are working
directly in GitHub with GitHub Pages, you can commit the change and wait for the site to rebuild. If you are working
locally, you will need to run `npm run dev` to restart your local server.

Once your site is running, you can check that the IIIF Collection was generated by visiting the Collection URI in your
browser. Canopy uses the [slugify](https://www.npmjs.com/package/slugify) package when generating IIIF Collections. In
this process, both the metadata label and metadata value are *slugified* to create the route to you collection. Slugifying
is beneficial for search engine optimization and readability.

The pattern for the URI for your Collection will be your site's base path followed by `/api/facet/${facet.slug}/${value.slug}`.
In this example, the Collection URI would be `/api/facet/subject/war-pensions`.

<Box m="9" my="6">
  ![Example Generated Collection](/examples/war-pensions-collection.png)
</Box>

<Callout >
  To learn more about how strings are slugified, see the [slugify](https://www.npmjs.com/package/slugify) package
  documentation.
</Callout>

### Add the Collection to your Custom Content

</Steps>